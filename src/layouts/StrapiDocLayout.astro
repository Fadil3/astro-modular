---
import { siteConfig } from '@/config';
import BaseLayout from '@/layouts/BaseLayout.astro';

interface Props {
  doc: {
    slug: string;
    title: string;
    description?: string;
    category?: string;
    version?: string;
    imageUrl?: string;
    html?: string;
    lastModified?: Date;
  };
}

const { doc } = Astro.props as Props;

const seoData = {
  title: `${doc.title} | ${siteConfig.title}`,
  description: doc.description,
  canonical: Astro.url.href,
  ogType: 'website' as const
};
---

<BaseLayout seoData={seoData}>
  <div class="py-8 relative">
    <div class="mx-auto px-4 sm:px-6 lg:px-8 relative" style={`max-width: ${siteConfig.layout.contentWidth}`}>
      <article class={`bg-primary-50 dark:bg-primary-900 rounded-lg border border-primary-200 dark:border-primary-700 shadow-sm ${doc.imageUrl ? 'overflow-hidden' : ''}`}>
        {doc.imageUrl && (
          <div class="h-40 sm:h-48 md:h-56 lg:h-64 overflow-hidden rounded-t-lg bg-primary-100 dark:bg-primary-800">
            <img src={doc.imageUrl} alt={`Featured image for documentation: ${doc.title}`} class="w-full h-full object-cover" width="800" height="256" loading="eager" fetchpriority="high" decoding="async" />
          </div>
        )}

        <div class={`p-6 ${doc.imageUrl ? 'rounded-b-lg' : 'rounded-lg'}`}>
          <header class="mb-4">
            <h1 class="text-xl font-bold text-primary-900 dark:text-primary-50 mb-6 leading-tight">{doc.title}</h1>
            
            <div class="flex flex-wrap items-center gap-x-4 gap-y-2 text-sm text-primary-600 dark:text-primary-300 mb-6">
              {doc.category && (
                <span class="font-medium">{doc.category}</span>
              )}
              {doc.version && (
                <span class="px-2.5 py-1 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-800 border border-primary-200 dark:border-primary-700">
                  v{doc.version}
                </span>
              )}
              {doc.lastModified && (
                <time datetime={doc.lastModified.toISOString()} class="font-medium">Last updated: {doc.lastModified.toLocaleDateString()}</time>
              )}
            </div>
          </header>

          <div class="prose dark:prose-dark max-w-none" id="doc-content" set:html={doc.html || ''} />
        </div>
      </article>
    </div>
  </div>

  <Fragment slot="scripts">
    <script>
      // Open external links in a new tab
      function processExternalLinks() {
        const allLinks = document.querySelectorAll('.prose a[href]');
        allLinks.forEach(link => {
          const href = link.getAttribute('href');
          if (href && (href.startsWith('http://') || href.startsWith('https://'))) {
            if (!link.hasAttribute('target')) {
              link.setAttribute('target', '_blank');
              link.setAttribute('rel', 'noopener noreferrer');
            }
          }
        });
      }
      document.addEventListener('DOMContentLoaded', processExternalLinks);
      document.addEventListener('swup:contentReplaced', () => setTimeout(processExternalLinks, 100));
    </script>
  </Fragment>
</BaseLayout>
