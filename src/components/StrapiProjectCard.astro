---
interface Props {
  project: {
    slug: string;
    title: string;
    description?: string;
    date: Date;
    imageUrl?: string;
    categories: string[];
    status?: string;
  };
  eager?: boolean;
}

const { project, eager = false } = Astro.props as Props;

// Normalize status for display
const displayStatus = project.status ? 
  project.status.toLowerCase() === 'in-progress' || project.status.toLowerCase() === 'in progress' ? 'In Progress' :
  project.status.toLowerCase() === 'completed' ? 'Completed' :
  project.status : undefined;
---

<article class="group project-card" role="article" aria-labelledby={`project-title-${project.slug}`}>
  <a href={`/project/${project.slug}`} class="block" aria-label={`View project: ${project.title}`}>
    {project.imageUrl && (
      <div class="overflow-hidden rounded-t-lg bg-primary-100 dark:bg-primary-800" style="aspect-ratio: 1.91 / 1;">
        <img 
          src={project.imageUrl}
          alt={`Featured image for project: ${project.title}`}
          class="w-full h-full object-cover group-hover:scale-102 transition-all duration-300"
          width="800"
          height="450"
          loading={eager ? 'eager' : 'lazy'}
          fetchpriority={eager ? 'high' : 'auto'}
          decoding="async"
        />
      </div>
    )}

    <div class={`p-4 ${project.imageUrl ? 'rounded-b-lg' : 'rounded-lg'}`}>
      <div class="flex flex-wrap items-center gap-x-3 gap-y-1 text-sm text-primary-500 dark:text-primary-400 mb-1">
        <time datetime={project.date.toISOString()}>{project.date.toLocaleDateString()}</time>
        {displayStatus && (
          <span class={`px-2.5 py-1 rounded-full text-xs font-medium ${
            displayStatus === 'Completed' 
              ? 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 border border-green-200 dark:border-green-700'
              : displayStatus === 'In Progress'
              ? 'bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 border border-yellow-200 dark:border-yellow-700'
              : 'bg-primary-100 dark:bg-primary-800 text-primary-700 dark:text-primary-200 border border-primary-200 dark:border-primary-700'
          }`}>
            {displayStatus}
          </span>
        )}
      </div>

      <h3 id={`project-title-${project.slug}`} class="text-base font-medium text-primary-900 dark:text-primary-100 leading-relaxed group-hover:text-highlight-600 dark:group-hover:text-highlight-400 transition-colors">
        {project.title}
      </h3>

      {project.description && (
        <p class="text-primary-600 dark:text-primary-300 line-clamp-2 text-sm leading-relaxed mt-1">
          {project.description}
        </p>
      )}

      {project.categories && project.categories.length > 0 && (
        <div class="mt-3">
          {project.categories.slice(0, 3).map((category) => (
            <span
              class="inline-block text-xs text-primary-600 dark:text-primary-300 bg-primary-100 dark:bg-primary-800 px-2.5 py-1 rounded-full border border-primary-200 dark:border-primary-700 mr-2 mb-1"
            >
              {category}
            </span>
          ))}
          {project.categories.length > 3 && (
            <span class="inline-block text-xs text-primary-500 dark:text-primary-400 bg-primary-50 dark:bg-primary-800 px-2.5 py-1 rounded-full border border-primary-200 dark:border-primary-700 mr-2 mb-1">
              + {project.categories.length - 3} more
            </span>
          )}
        </div>
      )}
    </div>
  </a>
</article>
